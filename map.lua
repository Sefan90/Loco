local map = {}

map.__index = map

function map.new(size,world)
    local self = setmetatable({}, map)
    self.color = {127,127,127}
    self.maxtimer = 5
    self.timer = 0
    self.remove = 1
    self.size = size
    self.world = world
    self.level = {{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0},
{0,0,0,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,0,0,0},
{0,0,0,1,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,1,0,0,0},
{0,0,0,1,2,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,5,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,5,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,5,6,7,8,8,8,8,8,8,8,8,8,8,8,8,7,6,5,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,5,6,7,8,9,9,9,9,9,9,9,9,9,9,8,7,6,5,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,5,6,7,8,9,10,10,10,10,10,10,10,10,9,8,7,6,5,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,5,6,7,8,9,10,11,11,11,11,11,11,10,9,8,7,6,5,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,12,12,12,11,10,9,8,7,6,5,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,99,99,12,11,10,9,8,7,6,5,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,99,99,12,11,10,9,8,7,6,5,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,12,12,12,11,10,9,8,7,6,5,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,5,6,7,8,9,10,11,11,11,11,11,11,10,9,8,7,6,5,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,5,6,7,8,9,10,10,10,10,10,10,10,10,9,8,7,6,5,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,5,6,7,8,9,9,9,9,9,9,9,9,9,9,8,7,6,5,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,5,6,7,8,8,8,8,8,8,8,8,8,8,8,8,7,6,5,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,5,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,5,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,3,2,1,0,0,0},
{0,0,0,1,2,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,2,1,0,0,0},
{0,0,0,1,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,1,0,0,0},
{0,0,0,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,0,0,0},
{0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0},
{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}}
    self.levelitems = {}
    for y = 1, #self.level do
    	self.levelitems[y] = {}
    	for x = 1, #self.level do
    		if self.level[y][x] >= 1 then
    			--player name för att det fixar så bullets inte fastnar i marken
    			local item = {name = 'x'..x..'y'..y, playername = 'ground', ground = true}
    			self.levelitems[y][x] = item
				world:add(item,(x-1)*self.size,(y-1)*self.size,self.size,self.size)
			end
    	end
    end
    return self
end

function map:update(world,dt)
	--Gör kartan mindre efter x sekunder
	self.timer = self.timer + dt
	if self.timer >= self.maxtimer then
		for y = 1, #self.level do
    		for x = 1, #self.level do
    			if self.level[y][x] == self.remove and self.levelitems[y][x] ~= nil and self.remove ~= 99 then
    				world:remove(self.levelitems[y][x])
    				self.levelitems[y][x] = nil
    				self.level[y][x] = -1
    			end
    		end
    	end
    	self.timer = 0
		self.remove = self.remove + 1
    end
end

function map:draw()
	love.graphics.setColor(self.color)
	for y = 1, #self.level do
    	for x = 1, #self.level do
    		if self.level[y][x] >= 1 then
    			love.graphics.rectangle('line', (x-1)*self.size, (y-1)*self.size, self.size, self.size)
    		end
    	end
    end
    love.graphics.setColor(255,255,255)
end

return map